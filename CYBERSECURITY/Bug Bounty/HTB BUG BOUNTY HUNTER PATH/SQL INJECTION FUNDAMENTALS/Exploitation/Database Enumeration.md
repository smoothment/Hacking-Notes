---
sticker: lucide//database
---
In the previous sections, we learned about different SQL queries inÂ `MySQL`Â and SQL injections and how to use them. This section will put all of that to use and gather data from the database using SQL queries within SQL injections.

---

## MySQL Fingerprinting

Before enumerating the database, we usually need to identify the type of DBMS we are dealing with. This is because each DBMS has different queries, and knowing what it is will help us know what queries to use.

As an initial guess, if the webserver we see in HTTP responses isÂ `Apache`Â orÂ `Nginx`, it is a good guess that the webserver is running on Linux, so the DBMS is likelyÂ `MySQL`. The same also applies to Microsoft DBMS if the webserver isÂ `IIS`, so it is likely to beÂ `MSSQL`. However, this is a far-fetched guess, as many other databases can be used on either operating system or web server. So, there are different queries we can test to fingerprint the type of database we are dealing with.

As we coverÂ `MySQL`Â in this module, let us fingerprintÂ `MySQL`Â databases. The following queries and their output will tell us that we are dealing withÂ `MySQL`:

| Payload            | When to Use                      | Expected Output                                     | Wrong Output                                              |
| ------------------ | -------------------------------- | --------------------------------------------------- | --------------------------------------------------------- |
| `SELECT @@version` | When we have full query output   | MySQL Version 'i.e.Â `10.3.22-MariaDB-1ubuntu1`'     | In MSSQL it returns MSSQL version. Error with other DBMS. |
| `SELECT POW(1,1)`  | When we only have numeric output | `1`                                                 | Error with other DBMS                                     |
| `SELECT SLEEP(5)`  | Blind/No Output                  | Delays page response for 5 seconds and returnsÂ `0`. | Will not delay response with other DBMS                   |

As we saw in the example from the previous section, when we triedÂ `@@version`, it gave us:

Â Â Â 

![](https://academy.hackthebox.com/storage/modules/33/db_version_1.jpg)

The outputÂ `10.3.22-MariaDB-1ubuntu1`Â means that we are dealing with aÂ `MariaDB`Â DBMS similar to MySQL. Since we have direct query output, we will not have to test the other payloads. Instead, we can test them and see what we get.

---

## INFORMATION_SCHEMA Database

To pull data from tables usingÂ `UNION SELECT`, we need to properly form ourÂ `SELECT`Â queries. To do so, we need the following information:

- List of databases
- List of tables within each database
- List of columns within each table

With the above information, we can form ourÂ `SELECT`Â statement to dump data from any column in any table within any database inside the DBMS. This is where we can utilize theÂ `INFORMATION_SCHEMA`Â Database.

TheÂ [INFORMATION_SCHEMA](https://dev.mysql.com/doc/refman/8.0/en/information-schema-introduction.html)Â database contains metadata about the databases and tables present on the server. This database plays a crucial role while exploiting SQL injection vulnerabilities. As this is a different database, we cannot call its tables directly with aÂ `SELECT`Â statement. If we only specify a table's name for aÂ `SELECT`Â statement, it will look for tables within the same database.

So, to reference a table present in another DB, we can use the dot â€˜`.`â€™ operator. For example, toÂ `SELECT`Â a tableÂ `users`Â present in a database namedÂ `my_database`, we can use:

```sql
SELECT * FROM my_database.users;
```

Similarly, we can look at tables present in theÂ `INFORMATION_SCHEMA`Â Database.

---

## SCHEMATA

To start our enumeration, we should find what databases are available on the DBMS. The tableÂ [SCHEMATA](https://dev.mysql.com/doc/refman/8.0/en/information-schema-schemata-table.html)Â in theÂ `INFORMATION_SCHEMA`Â database contains information about all databases on the server. It is used to obtain database names so we can then query them. TheÂ `SCHEMA_NAME`Â column contains all the database names currently present.

Let us first test this on a local database to see how the query is used:

```shell-session
mysql> SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA;

+--------------------+
| SCHEMA_NAME        |
+--------------------+
| mysql              |
| information_schema |
| performance_schema |
| ilfreight          |
| dev                |
+--------------------+
6 rows in set (0.01 sec)
```

We see theÂ `ilfreight`Â andÂ `dev`Â databases.

Note: The first three databases are default MySQL databases and are present on any server, so we usually ignore them during DB enumeration. Sometimes there's a fourth 'sys' DB as well.

Now, let's do the same using aÂ `UNION`Â SQL injection, with the following payload:

```sql
cn' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- -
```

Â Â Â 

![](https://academy.hackthebox.com/storage/modules/33/ports_dbs.png)

Once again, we see two databases,Â `ilfreight`Â andÂ `dev`, apart from the default ones. Let us find out which database the web application is running to retrieve ports data from. We can find the current database with theÂ `SELECT database()`Â query. We can do this similarly to how we found the DBMS version in the previous section:

```sql
cn' UNION select 1,database(),2,3-- -
```

Â Â Â 

![](https://academy.hackthebox.com/storage/modules/33/db_name.jpg)

We see that the database name isÂ `ilfreight`. However, the other database (`dev`) looks interesting. So, let us try to retrieve the tables from it.

---

## TABLES

Before we dump data from theÂ `dev`Â database, we need to get a list of the tables to query them with aÂ `SELECT`Â statement. To find all tables within a database, we can use theÂ `TABLES`Â table in theÂ `INFORMATION_SCHEMA`Â Database.

TheÂ [TABLES](https://dev.mysql.com/doc/refman/8.0/en/information-schema-tables-table.html)Â table contains information about all tables throughout the database. This table contains multiple columns, but we are interested in theÂ `TABLE_SCHEMA`Â andÂ `TABLE_NAME`Â columns. TheÂ `TABLE_NAME`Â column stores table names, while theÂ `TABLE_SCHEMA`Â column points to the database each table belongs to. This can be done similarly to how we found the database names. For example, we can use the following payload to find the tables within theÂ `dev`Â database:

```sql
cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'-- -
```

Note how we replaced the numbers '2' and '3' with 'TABLE_NAME' and 'TABLE_SCHEMA', to get the output of both columns in the same query.

Â Â Â 

![](https://academy.hackthebox.com/storage/modules/33/ports_tables_1.jpg)

```ad-note
Note: we added a (where table_schema='dev') condition to only return tables from the 'dev' database, otherwise we would get all tables in all databases, which can be many.
```

We see four tables in the dev database, namelyÂ `credentials`,Â `framework`,Â `pages`, andÂ `posts`. For example, theÂ `credentials`Â table could contain sensitive information to look into it.

---

## COLUMNS

To dump the data of theÂ `credentials`Â table, we first need to find the column names in the table, which can be found in theÂ `COLUMNS`Â table in theÂ `INFORMATION_SCHEMA`Â database. TheÂ [COLUMNS](https://dev.mysql.com/doc/refman/8.0/en/information-schema-columns-table.html)Â table contains information about all columns present in all the databases. This helps us find the column names to query a table for. TheÂ `COLUMN_NAME`,Â `TABLE_NAME`, andÂ `TABLE_SCHEMA`Â columns can be used to achieve this. As we did before, let us try this payload to find the column names in theÂ `credentials`Â table:

```sql
cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'-- -
```

Â Â Â 

![](https://academy.hackthebox.com/storage/modules/33/ports_columns_1.jpg)

The table has two columns namedÂ `username`Â andÂ `password`. We can use this information and dump data from the table.

---

## Data

Now that we have all the information, we can form ourÂ `UNION`Â query to dump data of theÂ `username`Â andÂ `password`Â columns from theÂ `credentials`Â table in theÂ `dev`Â database. We can placeÂ `username`Â andÂ `password`Â in place of columns 2 and 3:

```sql
cn' UNION select 1, username, password, 4 from dev.credentials-- -
```

Remember: don't forget to use the dot operator to refer to the 'credentials' in the 'dev' database, as we are running in the '`ilfreight`' database, as previously discussed.

Â Â Â 

![](https://academy.hackthebox.com/storage/modules/33/ports_credentials_1.png)

We were able to get all the entries in theÂ `credentials`Â table, which contains sensitive information such as password hashes and an API key.


# Question
---
![Pasted image 20250203140153.png](../../../../IMAGES/Pasted%20image%2020250203140153.png)

We can use the following to enumerate the tables from the `ilfreight` database:

```
cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='ilfreight'-- -
```

We can see the following:


![Pasted image 20250203140227.png](../../../../IMAGES/Pasted%20image%2020250203140227.png)

Now, let's read the `users` columns:

```
cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='users'-- -
```

![Pasted image 20250203141432.png](../../../../IMAGES/Pasted%20image%2020250203141432.png)

We can now read it with: 

```
cn' UNION select 1, username, password, 4 from ilfreight.users-- -
```

![Pasted image 20250203141526.png](../../../../IMAGES/Pasted%20image%2020250203141526.png)

Hash is: `9da2c9bcdf39d8610954e0e11ea8f45f`
